<head>
  
  <style>
    .themediv{
      position:relative;
      background-color:white;
      float:left;
      padding: 1ex;
    }
    .themediv h3{
      font-size:80%;
    }
    .themediv .previewdiv{
      border: 1px solid black;
      border-radius:3px;
      display:block;
      width:202px;
      height:152px;
    }
    .themediv .clicker{
      z-index:10;
      cursor:hand;
      position:absolute;
      width:202px;
      height:152px;
    }
  </style>
  <link type="text/css" href="/static/global.css" rel="stylesheet"/>
  <script type='text/javascript' src='/static/js/jquery-1.7.2.min.js' ></script>
  <script type="text/javascript" src="http://www.websnapr.com/js/websnapr.js"></script>
</head>
<body>
  <h2>Choose a theme</h2>
  <div>
  {% for theme in themes %}
    <div class='themediv' id="theme-{{theme.name}}">
      <h3><a href='javascript:themeselected("{{theme.name}}")'>{{theme.name}}</a> by {{ theme.submitter }}</h3>
      <div class='clicker' click='clicker_click();'></div>
      <div class='previewdiv'>
	<script type="text/javascript">wsr_snapshot('http://iiumschedule.appspot.com/screenshot?themename={{theme.name}}', 'xe55Qpu0ssL9', 'small');</script>
      </div>
    </div>
  {% endfor %}
  </div>
  <div style='clear:both;' />
  <p>Please contribute to the community of IIUM by <a href="javascript:submit()">submitting</a> your own design</p>
</body>
  <script type='application/javascript'>
    function submit(){
     var newwindow=window.open("/themegallery?submit=1","Submit Theme",'width=400,height=200,toolbar=yes,location=yes,directories=yes,status=yes,menubar=yes,scrollbars=yes,copyhistory=yes,resizable=yes');
     $(newwindow).load(function(){
      var thestyle=parent.getcurrentstyle();
      newwindow.$("textarea[name=style]").html(thestyle);
      newwindow.$("textarea[name=template]").text(parent.getcurrenttemplate());
      $.get("/static/defaultdata",{},function(data){
	var dataobj=JSON.parse(data);
	dataobj.style=thestyle;
	newwindow.$("textarea[name=rendered]").text(parent.renderdata(dataobj));
      });
      console.log("after sending get");
     });
    }
    
    function themeselected(themename){
      $.getJSON("/themegallery?name="+themename,function(data){
	parent.applyStyle(data.style);
	parent.applyTemplate(data.template);
      });
    }
    
    $(".themediv").click(function(){
      var theid=$(this).attr("id");
      var themename=theid.substring(6);
      themeselected(themename);
    });
    
    $("div.themediv div.clicker").click(function(){
      var theid=$(this).parents(".themediv").attr("id");
      var themename=theid.substring(6);
      themeselected(themename);
    });
    
  </script>