function RGBToHSL(c,g,i){var l=Math.min(c,g,i),r=Math.max(c,g,i),m=r-l,t=0,w=0,x=(l+r)/2;0!=m&&(w=0.5>x?m/(r+l):m/(2-r-l),t=60*(c==r?(g-i)/m:g==r?2+(i-c)/m:4+(c-g)/m));0>t&&(t+=360);return[t,w,x]}function HSLToRGB(c,g,i){if(0==g)return[i,i,i];for(var g=0.5>i?i*(1+g):i+g-i*g,i=2*i-g,c=c/360,c=[(c+1/3)%1,c,(c+2/3)%1],l=0;3>l;++l)c[l]=c[l]<1/6?i+6*(g-i)*c[l]:0.5>c[l]?g:c[l]<2/3?i+6*(g-i)*(2/3-c[l]):i;return c}function roundNumber(c,g){return Math.round(c*Math.pow(10,g))/Math.pow(10,g)}
void 0==window.staticpath&&(window.staticpath="/static/colorpicker/");
function initColorChooser(){function c(a,b,d,j){a=RGBToHSL(a/255,b/255,d/255);n=a[0];p=100*a[1];s=100*a[2];k=j;r();m()}function g(a,b,d){return c(parseInt(a,16),parseInt(b,16),parseInt(d,16),1)}function i(){z||l(q.val())}function l(a){if(/^\s*$/.test(a))h=0;else{var b=/^\s*#([0-o9a-fA-F]{6})\s*$/;if(b=b.exec(a))h=0,g(b[1].slice(0,2),b[1].slice(2,4),b[1].slice(4,6));else if(b=/^\s*#([0-o9a-fA-F]{3})\s*$/,b=b.exec(a))h=1,g(b[1].slice(0,1),b[1].slice(1,2),b[1].slice(2,3));else if(b=/^\s*rgb\((\d+),(\d+),(\d+)\)\s*$/,
b=b.exec(a))h=2,c(b[1],b[2],b[3],1);else if(b=/^\s*rgba\((\d+),(\d+),(\d+),([\d\.]+)\)\s*$/,b=b.exec(a))h=3,c(b[1],b[2],b[3],b[4]);else if(b=/^\s*hsl\((\d+),(\d+)%?,(\d+)%?\)\s*$/,b=b.exec(a)){h=4;var a=b[2],d=b[3];n=b[1];p=a;lighness=d;k=1;r();m()}else b=/^\s*hsla\((\d+),(\d+)%?,(\d+)%?,([\d\.]+)\)\s*$/,(b=b.exec(a))?(h=5,a=b[2],d=b[3],n=b[1],p=a,lighness=d,k=1,r(),m()):(console.log("WARNING unknown color value.->"+a),h=0)}}function r(){var a=y.getContext("2d");a.fillStyle="white";a.fillRect(0,0,
100,100);for(var b=a.getImageData(0,0,100,100),d=b.data,j=0;100>j;j++)for(var e=0;100>e;e++){var c=HSLToRGB(n,e/100,(100-j)/100);c[0]*=255;c[1]*=255;c[2]*=255;d[4*(100*j+e)]=c[0];d[4*(100*j+e)+1]=c[1];d[4*(100*j+e)+2]=c[2];d[4*(100*j+e)+3]=255}a.putImageData(b,0,0)}function m(){d.find("input[name=hue]").val(n);d.find("input[name=saturation]").val(p);d.find("input[name=lightness]").val(s);d.find("input[name=alpha]").val(k);var a=function(a){q.val(a);q.css("background-color",a);z=!0;q.change();z=!1},
b=HSLToRGB(n,p/100,s/100),c=Math.floor(255*b[0]),j=Math.floor(255*b[1]),b=Math.floor(255*b[2]);if(1!=k){if(0==h||1==h||2==h)h=3;4==h&&(h=5)}else 3==h&&(h=0),5==h&&(h=4);0==h||1==h?(c=c.toString(16),1==c.length&&(c="0"+c),j=j.toString(16),1==j.length&&(j="0"+j),b=b.toString(16),1==b.length&&(b="0"+b),a("#"+c+j+b)):2==h?a("rgb("+c+","+j+","+b+")"):3==h?(c="rgba("+c+","+j+","+b+","+k+")",a(c)):4==h?(c="hsl("+n+","+p+"%,"+s+"%)",a(c)):5==h&&(c="hsla("+n+","+p+"%,"+s+"%,"+k+")",a(c))}function t(){F.css("background-color",
"hsla("+n+","+p+"%,"+s+"%,"+k+")");var a=f.get(0).getContext("2d");a.save();a.fillStyle="#777";a.fillRect(0,0,200,200);a.drawImage(B,5,5,190,190);a.drawImage(C,50,50,100,100);a.globalAlpha=k;a.drawImage(y,50,50,100,100);a.globalAlpha=1;a.save();a.translate(100,100);a.rotate(n*Math.PI/180);a.lineWidth=2;a.beginPath();a.moveTo(0,-95);a.lineTo(0,-77);a.stroke();a.closePath();a.restore();var b=100-s,c=p;a.beginPath();a.arc(50+c,50+b,3,0,2*Math.PI);a.lineWidth=1;a.stroke();a.closePath();a.drawImage(D,
5,205);b=a.createLinearGradient(5,0,195,0);b.addColorStop(0,"hsla("+n+","+p+"%,"+s+"%,0)");b.addColorStop(1,"hsla("+n+","+p+"%,"+s+"%,1)");a.fillStyle=b;a.fillRect(5,205,190,20);a.beginPath();a.moveTo(5+190*k,205);a.lineTo(5+190*k,225);a.lineWidth=2;a.stroke();a.closePath();a.restore()}function w(){t();setTimeout(w,100)}function x(){d.slideUp(G());$("body").unbind("click",x);q&&(q.unbind("change",i),q=!1);u=v=void 0}function E(){A=!1;d.find(".innercontainer").animate({left:0},500)}function G(){d.width(285);
d.find(".palettelist").empty();E()}$("#colorchooser").length||$("body").append("<div id='colorchooser'>\n        <div class='innercontainer'>\n        <canvas class='colorcanvas' width=\"200\" height=\"230\"></canvas>\n        <div class='sidebox'>\n            <div class='backboxtile'></div>\n            <div class='previewbox'></div>\n            <div class='comparebox'></div>\n            <div class='inputbox'>\n            <span class='label'>Hue:</span><br />\n            <input name='hue'></input><br />\n            <span class='label'>Saturation:</span><br />\n            <input name='saturation'></input><br />\n            <span class='label'>Lightness:</span><br />\n            <input name='lightness'></input><br />\n            <span class='label'>Alpha:</span><br />\n            <input name='alpha'></input><br />\n            </div>\n        </div>\n        <div class='palettebox'>\n            <div class='paletteicon'></div>\n            <div class='palettelist'>\n                \n            </div>\n        </div>\n        </div>\n        </div>");
var d=$("#colorchooser"),f=d.find(".colorcanvas"),F=d.find(".previewbox"),H=d.find(".comparebox"),B=new Image;B.src=staticpath+"huecircle.png";var C=new Image;C.src=staticpath+"backtile.png";var D=new Image;D.src=staticpath+"alphatile.png";var y=document.createElement("canvas");y.width=100;y.height=100;var q=!1,I=5,n=45,p=100,s=50,k=1,z=!1,v,u,h=0;r();d.find(".inputbox input").change(function(){if(/[\d\.]+/.test(d.find("input[name=hue]").val())){var a=parseInt(d.find("input[name=hue]").val(),0);0<
a&&360>a&&(n=a,r())}/[\d\.]+/.test(d.find("input[name=saturation]").val())&&(a=parseInt(d.find("input[name=saturation]").val(),0),0<a&&100>a&&(p=a));/[\d\.]+/.test(d.find("input[name=lightness]").val())&&(a=parseInt(d.find("input[name=lightness]").val(),0),0<a&&100>a&&(s=a));/[\d\.]+/.test(d.find("input[name=alpha]").val())&&(a=parseFloat(d.find("input[name=alpha]").val()),0<a&&1>a&&(k=a))});w();f.bind("mousedown",function(a){function b(){v&&u&&u.setInputColor(v,"")}function c(a,d){var e=Math.atan2(a,
d),e=180*e/Math.PI,e=e+90;0>e&&(e+=360);n=Math.floor(e);r();t();m();b()}var d=f.offset(),e=a.pageX-d.left,a=a.pageY-d.top,d=e-100,h=a-100,i=Math.sqrt(d*d+h*h);if(95>i&&77<i)return c(h,d),f.bind("mousemove",function(a){var b=f.offset();c(a.pageY-b.top-100,a.pageX-b.left-100)}),e=function(){f.unbind("mouseup");f.unbind("mouseout");f.unbind("mousemove")},f.bind("mouseup",e),f.bind("mouseout",e),!1;if(50<e&&150>e&&50<a&&150>a)return p=e-50,s=100-(a-50),t(),m(),b(),f.bind("mousemove",function(a){var d=
f.offset(),c=a.pageY-d.top,a=a.pageX-d.left-50;0>a&&(a=0);100<a&&(a=100);c-=50;0>c&&(c=0);100<c&&(c=100);p=a;s=100-c;t();m();b();return!1}),e=function(){f.unbind("mouseup");f.unbind("mouseout");f.unbind("mousemove")},f.bind("mouseup",e),f.bind("mouseout",e),!1;if(5<e&&195>e&&205<a&&225>a)return k=(e-5)/190,k=roundNumber(k,3),m(),b(),f.bind("mousemove",function(a){var c=f.offset(),a=a.pageX-c.left-5;0>a&&(a=0);190<a&&(a=190);k=a/190;k=roundNumber(k,3);m();b();return!1}),e=function(){f.unbind("mouseup");
f.unbind("mouseout");f.unbind("mousemove")},f.bind("mouseup",e),f.bind("mouseout",e),!1});t();d.click(function(){return!1});var A=!1;d.find(".paletteicon").click(function(){A?E():(A=!0,d.find(".innercontainer").animate({left:-200},500))});showColorChooser=function(a,b,c){function h(){if(void 0!=b){v=b;u=c;d.width(310);var e=u.getPalette(),f=u.getCurrentColorName(v),g;for(g in e){var j=$("<div class='paletteitem'>"),k=$("<div class='paletteitembox'>");k.attr("title",g);g==f&&j.toggleClass("selected");
k.css("background-color",e[g]);j.append(k);j.append("<span class='colorname'>"+g+"<span>");j.append("<br />");j.click(function(){var a=$(this).find(".colorname").text();u.setInputColor(v,a);var b=u.getPalette();l(b[a]);d.find(".palettelist .selected").toggleClass("selected");$(this).toggleClass("selected")});d.find(".palettelist").append(j)}}e=a.offset();f=e.left;g=e.top+a.outerHeight()+I;f=f-d.outerWidth()/2+a.outerWidth()/2;f+d.outerWidth()>$(window).width()&&(f=$(window).width()-d.outerWidth());
0>f&&(f=0);g+d.outerHeight()>$(window).height()&&(g=e.top-d.outerHeight());0>g&&(g=0);d.css("left",f);d.css("top",g);d.slideDown();$("body").click(x);q=a;q.bind("change",i);H.css("background-color",q.val());l(q.val())}q!=a&&(q&&q!=a?d.slideUp(h):h())}}initColorChooser();