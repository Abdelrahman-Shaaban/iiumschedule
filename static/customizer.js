/*! iiumschedule 2014-06-26 */
function postpage(){}function togglealternate(){$("#expandbutton").text($("#previewiframe").hasClass("alternate")?"Expand":"Shrink"),$("#previewiframe").toggleClass("alternate"),$("#configiframe").toggleClass("alternate")}function getcurrentstyle(){if(void 0===parsed_data.style){var theiframe=$("#previewiframe");parsed_data.style=theiframe.contents().find("#thestyle").html()}return parsed_data.style}function getcurrenttemplate(){return void 0!==currenttemplate?currenttemplate:$("#scheduletemplate").html()}function currentrendered(){var theiframe=$("#previewiframe"),thetext=theiframe.contents().find("html").html();return thetext}function renderdata(data){var cdata=data;return void 0===cdata&&(cdata=parsed_data),new EJS({text:currenttemplate}).render(cdata)}function rerender(style){void 0===style&&(style=getcurrentstyle()),parsed_data.style=style;var thetext=renderdata(parsed_data),theiframe=$("#previewiframe");theiframe.contents().find("html").html(thetext)}function changetemplatepage(){postpage(),$("#configiframe").bind("load",function(){document.getElementById("configiframe").contentWindow.changetemplate(getcurrenttemplate()),$("#configiframe").unbind("load"),postpage=function(){}}),$("#configiframe").attr("src","/static/templateeditor.html")}function themegallery(){postpage(),$("#configiframe").bind("load",function(){$("#configiframe").unbind("load"),postpage=function(){}}),$("#configiframe").attr("src","/themegallery")}function settingspage(){postpage(),postpage=function(){},$("#configiframe").attr("src","/static/settings.html")}function manualcsspage(){postpage(),$("#configiframe").bind("load",function(){document.getElementById("configiframe").contentWindow.changeStyle(getcurrentstyle()),$("#configiframe").unbind("load"),postpage=function(){}}),$("#configiframe").attr("src","/static/csseditor.html")}function stylercsspage(){postpage(),$("#configiframe").bind("load",function(){var thewindow=document.getElementById("configiframe").contentWindow;thewindow.parseCSS(getcurrentstyle(),$("#previewiframe")),$("#configiframe").unbind("load"),postpage=function(){document.getElementById("configiframe").contentWindow.savestyle()}}),$("#configiframe").attr("src","/static/styler.html")}function applyStyle(thestyle){rerender(thestyle)}function applyTemplate(template){currenttemplate=template,rerender()}function saveStyle(){postpage(),console.log("Saving Style");var theiframe=$("#previewiframe"),data=theiframe.contents().find("html").html();console.log("Posting schedule"),$.post(window.location.origin+"/scheduleformatter/",{data:data,custom:1,no_post_process:1,ctoken:ctoken},function(){console.log("Schedule posted")})}function makearray(length){for(var thearray=[],i=0;length>i;)thearray.push(""),i+=1;return thearray}function convert_data(data){for(var studentname=data.studentname,coursearray=data.coursearray,starthour=8,actualstarthour=20,actualendhour=8,i=0;i<coursearray.length;){for(var i2=0,ccourse=coursearray[i];i2<ccourse.schedule.length;){var sched=ccourse.schedule[i2],start=Math.floor(sched.start);actualstarthour>start&&(actualstarthour=start);var end=Math.floor(sched.end);sched.end>end&&(end+=1),end>actualendhour&&(actualendhour=end),i2+=1}i+=1}for(var startfminute=12*actualstarthour,hournum=14,actualhournum=actualendhour-actualstarthour,fiveminutenum=12*actualhournum,byday={MON:makearray(hournum),TUE:makearray(hournum),WED:makearray(hournum),THUR:makearray(hournum),FRI:makearray(hournum),SAT:makearray(hournum),SUN:makearray(hournum)},scaledbyday={MON:makearray(actualhournum),TUE:makearray(actualhournum),WED:makearray(actualhournum),THUR:makearray(actualhournum),FRI:makearray(actualhournum),SAT:makearray(actualhournum),SUN:makearray(actualhournum)},byfiveminute={MON:makearray(fiveminutenum),TUE:makearray(fiveminutenum),WED:makearray(fiveminutenum),THUR:makearray(fiveminutenum),FRI:makearray(fiveminutenum),SAT:makearray(fiveminutenum),SUN:makearray(fiveminutenum)},ci=0;ci<coursearray.length;){for(var course=coursearray[ci],si=0;si<course.schedule.length;){var schedule=course.schedule[si],start=schedule.start,end=schedule.end,starth=Math.floor(start),startm=start-starth;startm=Math.round(100*startm/5),startm+=12*starth;var endh=Math.floor(end),endm=end-endh;endm=Math.round(100*endm/5),endm+=12*endh;var durationh=endh-starth;byday[schedule.day][starth-starthour]={course:course,duration:durationh,venue:course.schedule[si].venue},scaledbyday[schedule.day][starth-actualstarthour]={course:course,duration:durationh,venue:course.schedule[si].venue};for(var i=1;durationh>i;)byday[schedule.day][start-starthour+i]="none",scaledbyday[schedule.day][start-actualstarthour+i]="none",i+=1;var durationm=endm-startm;for(byfiveminute[schedule.day][startm-startfminute]={course:course,duration:durationm,venue:course.schedule[si].venue},i=1;durationm>i;)byfiveminute[schedule.day][startm-startfminute+i]="none",i+=1;si+=1}ci+=1}var thedata={studentname:studentname,schedule:byday,scaledday:scaledbyday,byfiveminute:byfiveminute,actualstarthour:actualstarthour,actualendhour:actualendhour,courselist:coursearray,matricnumber:data.matricnumber,ic:data.ic,session:data.session,semester:data.semester,program:data.program};return thedata}function formatschedule(){window.parsed_data=convert_data(data),parsed_data.settings=currentsettings,$.get("/static/default.html",function(data){currenttemplate=data,$.get("/static/default.css",function(data){parsed_data.style=data,rerender(data),themegallery()})})}window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.host);var currenttemplate,parsed_data,currentsettings={show_day:{MON:!0,TUE:!0,WED:!0,THUR:!0,FRI:!0,SAT:!0,SUN:!1},fixminutealign:!0,showpersonalinfo:!0,showcoursetable:!0,showfulldayname:!1,coursetable:{code:!0,section:!0,credit:!0,name:!0,lecturer:!0}},day_name={MON:"monday",TUE:"tuesday",WED:"wednesday",THUR:"thursday",FRI:"friday",SAT:"saturday",SUN:"sunday"},rand=function(){return Math.random().toString(36).substr(2)},token=function(){return rand()+rand()},ctoken=token();$("#savebutton a").attr("href","/scheduleloader?ctoken="+ctoken),$("#savebutton a").click(saveStyle),$("#tabmenulist td > a").click(function(){var thetd=$(this).parent();"savebutton"!=thetd.attr("id")&&($("#tabmenulist td.selected").toggleClass("selected"),thetd.addClass("selected"))});