<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="/static/css/bootstrap.min.css"></link>
	<script src="/static/js/jquery-1.9.1.js"></script>
	<script src="/static/js/angular.min.js"></script>
    <script type='text/javascript' src='/static/ejs_production.js' ></script>
	<title>Schedule Maker</title>
    <style>
        #scheduletable .fixminutealign,#scheduletable .fixminutealign>td{
            margin:0;
            padding:0;
            height:0;
            width:0;
        }
        html,body{
            height:100%;
        }
        #main{
            padding:1em;
            height:100%;
            box-sizing:border-box;
            -moz-box-sizing:border-box;
        }
        .height100{
            height:100%;
        }
        .yscrollonly{
            overflow-y:auto;
            overflow-x:hidden;
        }
    </style>
    <script type='text/ejs' id="schedtemplate">
<table id='scheduletable' class="table table-bordered table-condensed">
    <tr>
      <td class='timecell'>Day</td>
      <% 
        for(var i=0;i<(actualendhour-actualstarthour);i++){
      %>
      <td class='timecell' colspan='12'><% 
      var thetime=i+actualstarthour; 
      var dtime=thetime;
      if(thetime>12){
          dtime=(dtime-12).toString()+" pm";
      }else if(thetime==12){
          dtime=dtime.toString()+" pm";
      }else{
          dtime=dtime.toString()+" am";
      }
      %><%= dtime %></td>
      <% } %>
    </tr>
    <% for(key in byfiveminute) {
        %>
    <tr>
      <td class='day firstcolumn'>
	<%= key.toLowerCase() %>
      </td>
      <% for(var i=0;i<byfiveminute[key].length;i=i+1){ %>
	<% if(byfiveminute[key][i].course){ %>
        <td class='nonempty <%=byfiveminute[key][i].course.hover?"bg-warning":""%>' colspan='<%= byfiveminute[key][i].duration %>'>
	      <div class='code'>
	      <%= byfiveminute[key][i].course.code %>
	      </div>
	  </td>
	<% }else if(byfiveminute[key][i]=="none"){ %>
	<% }else{ 
        var howmuch=1;
        var ci=i+1;
        while(ci<byfiveminute[key].length){
            if(byfiveminute[key][ci]!=""){
                break;
            }else{
                howmuch+=1;
            }
            ci=ci+1;
        }
        %>
	  <td class='empty' colspan='<%= howmuch %>'>
	      <%= byfiveminute[key][i]%>
	  </td>
	<% i=i+howmuch-1} %>
      <% } %>
    </tr>
    <% } %>
    <tr class='fixminutealign'>
      <td></td>
      <% for(var i=0; i<actualendhour-actualstarthour;i=i+1){ %>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
      <td class='align'></td>
        <% } %>
    </tr>
  </table>
    </script>
</head>
<body ng-app>

	{% raw %}

	<div id="main" ng-controller="schedulemaker">
		<div ng-show="mode=='startpage'">
			<form name="start_form" ng-submit="start_form_submit()" class="form-horizontal col-lg-8 col-lg-offset-2">
				<h1 class="text-center">This is the startpage</h1>
				<div class="form-group">
					<div class="col-md-4 control-label">Session</div>
					<div class="col-md-8">
						<select required class="form-control" ng-model="session" name="session" ng-options="x for x in available_sessions"></select>
					</div>
				</div>
				<div class="form-group">
					<div class="col-md-4 control-label">Semester</div>
					<div class="col-md-8">
						<select required class="form-control" ng-model="semester" name="semester" ng-options="x for x in [1,2,3]"></select>
					</div>
				</div>
				<div class="form-group">
					<div class="col-md-4 control-label">Student Type</div>
					<div class="col-md-8">
						<select required class="form-control" ng-model="student_type" name="student_type" ng-options="k as v for (k,v) in available_student_type"></select>
					</div>
				</div>
				<div class="form-group">
					<div class="col-md-4 control-label"></div>
					<div class="col-md-8">
						<div ng-show="show_submit_error">please select all parameters above.</div>
						<input type="submit" name="Start" class="btn btn-primary"></input>
					</div>

				</div>
			</form>
		</div>

		<div ng-show="mode=='startloading'">
			Fetching data		
		</div>

        <div ng-show="mode=='picker'" class="height100">
            <div class="row height100">
                <div class="col-lg-6 height100">
                    <h1>Schedule</h1>    
                    <div id="scheduleholder">
                    </div>
                    <div>
                        <table class="table-bordered table table-striped">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Lecturer</th>
                                    <th>Time</th>
                                    <th>Venue</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="x in schedule">
                                    <td>{{x.code}}</td>
                                    <td>{{x.lecturer}}</td>
                                    <td>{{x.day}} {{x.time}}</td>
                                    <td>{{x.venue}}</td>
                                    <td><a class="btn btn-danger glyphicon glyphicon-remove" ng-click="remove_section(x.section_id)"></a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="col-lg-6 height100">
                    <h3>Add Section</h3>

                    <div ng-show="selector.mode=='subject'" style="margin-bottom:5px">
                        <span>Select a subject</span>
                        <div class="input-group">
                            <input class="form-control" ng-model="selector.subsearch"></input>
                            <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>
                        </div>
                    </div>

                    <div ng-show="selector.mode=='section'" style="margin-bottom:5px">
                        Select a section from {{selector.selected_subject.code}} to add

                        <div class="input-group">
                            <span class="input-group-addon" ng-click="selector.mode='subject';cur_hover_section=undefined">Back</span>
                            <input class="form-control" ng-model="selector.secsearch"></input>
                            <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>
                        </div>
                    </div>

                    <div class="row">

                        <div class="col-sm-4 height100 yscrollonly" ng-show="selector.mode=='subject'">
                            <span>Kuliyyahs</span>    
                            <div class="list-group">
                                <a ng-repeat="(k,v) in coursearray" ng-class="'list-group-item '+(selector.selected_kuly==k?'active':'') " ng-click="selector.toggle_selected(k)">{{k}}</a>
                            </div>
                        </div>
                        <div ng-class="( selector.mode=='subject'?'col-sm-8':'col-sm-4' )+' yscrollonly height100'">
                            <span>Subject</span>    
                            <div class="list-group">
                                <a class="list-group-item" ng-repeat="(k,v) in selector.asubject | filter:{kuliyyah:selector.selected_kuly} | filter:selector.subsearch " ng-class="'list-group-item '+(selector.selected_subject==v?'active':'') "  ng-click="selector.show_section(v)">
                                    <i class="glyphicon glyphicon-ok pull-right" ng-show="subject_added(v.code)"></i>
                                    {{v.code}}<br />
                                    <small>{{v.title}}</small><br />
                                </a>
                            </div>                        
                        </div>

                        <div class="col-sm-8 yscrollonly" ng-show="selector.mode=='section'">
                            <div ng-show="selector.loading_section==false">

                                <table class="table table-borderd">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Lecturer</th>
                                            <th>Time</th>
                                            <th>Venue</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="v in selector.csections | filter:selector.secsearch" ng-class="has_collide(v)?'bg-warning':''" ng-mouseenter="$parent.cur_hover_section=v;" ng-mouseleave="$parent.cur_hover_section=undefined;">
                                            <td>{{v.section}}</td>
                                            <td>{{v.lecturer}}</td>
                                            <td>{{v.day}} {{v.time}}</td>
                                            <td>{{v.venue}}</td>
                                            <td class="text-center">
                                                <div ng-show="!section_added(v.section_id)">
                                                    <div ng-show="!has_collide(v)">
                                                        <a class="btn btn-default" ng-click="replace_section(v,selector.selected_subject)" ng-show="subject_added(selector.selected_subject.code)">Replace</a>
                                                        <a class="btn btn-default" ng-click="add_section(v)" ng-show="!subject_added(selector.selected_subject.code)">Add</a>
                                                    </div>
                                                    <div ng-show="has_collide(v)">
                                                        <small>
                                                            Collide with {{has_collide(v).code}} section {{has_collide(v).section}}
                                                        </small>
                                                    </div>
                                                </div>
                                                <div ng-show="section_added(v.section_id)">
                                                    <i class="glyphicon glyphicon-ok" ng-show="section_added(v.section_id)"></i>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                            <div ng-show="selector.loading_section==true">
                                Loading
                            </div>
                        </div>



                    </div>

                </div>
            </div>



            </div>
        </div>
	</div>

	{% endraw %}

	<script src="/static/js/bootstrap.min.js"></script>

	<script src="/static/js/schedulemaker.js"></script>

</body>
</html>
